<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Attendance System - Complete Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            background: white;
            padding: 10px 20px;
            border-radius: 10px 10px 0 0;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .tab:hover {
            transform: translateY(-2px);
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .panel {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: none;
            max-height: 80vh;
            overflow-y: auto;
        }

        .panel.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: #667eea;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }

        .btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn.secondary {
            background: #6c757d;
        }

        .btn.secondary:hover {
            background: #5a6268;
        }

        .btn.success {
            background: #28a745;
        }

        .btn.danger {
            background: #dc3545;
        }

        .response-box {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            margin: 10px 0;
        }

        .status-badge.success {
            background: #28a745;
            color: white;
        }

        .status-badge.error {
            background: #dc3545;
            color: white;
        }

        .user-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .swagger-link {
            display: inline-block;
            background: #85ea2d;
            color: #173647;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            margin-top: 20px;
            transition: all 0.3s;
        }

        .swagger-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .qr-container {
            text-align: center;
            margin: 20px 0;
        }

        .qr-code {
            background: white;
            padding: 20px;
            border-radius: 10px;
            display: inline-block;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-right: 5px solid #667eea;
        }

        .card h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th, .table td {
            padding: 10px;
            text-align: right;
            border-bottom: 1px solid #ddd;
        }

        .table th {
            background-color: #667eea;
            color: white;
        }

        .table tr:hover {
            background-color: #f5f5f5;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 600px;
            position: relative;
        }

        .close {
            position: absolute;
            left: 20px;
            top: 10px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #dc3545;
        }

        .room-map {
            height: 400px;
            border: 2px solid #ddd;
            border-radius: 10px;
            margin: 20px 0;
            position: relative;
            background: #f8f9fa;
        }

        .info-box {
            background: #e7f3ff;
            border-right: 4px solid #2196F3;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .warning-box {
            background: #fff3cd;
            border-right: 4px solid #ff9800;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .error-box {
            background: #f8d7da;
            border-right: 4px solid #dc3545;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .success-box {
            background: #d4edda;
            border-right: 4px solid #28a745;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„Ø°ÙƒÙŠ - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙƒØ§Ù…Ù„Ø©</h1>
            <p>Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ù…ÙŠØ¹ APIs ÙˆØ§Ù„ÙˆØ¸Ø§Ø¦Ù</p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('auth')">ğŸ” Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©</div>
            <div class="tab" onclick="showTab('students')">ğŸ‘¥ Ø§Ù„Ø·Ù„Ø§Ø¨</div>
            <div class="tab" onclick="showTab('rooms')">ğŸ¢ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª</div>
            <div class="tab" onclick="showTab('schedules')">ğŸ“… Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„</div>
            <div class="tab" onclick="showTab('lectures')">ğŸ“š Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</div>
            <div class="tab" onclick="showTab('qr')">ğŸ“± QR Codes</div>
            <div class="tab" onclick="showTab('attendance')">âœ… Ø§Ù„Ø­Ø¶ÙˆØ±</div>
            <div class="tab" onclick="showTab('reports')">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
        </div>

        <!-- Auth Panel -->
        <div id="auth-panel" class="panel active">
            <h2>ğŸ” Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©</h2>
            
            <div class="grid">
                <!-- Admin Login -->
                <div class="card">
                    <h3>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©/Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ†</h3>
                    <div class="form-group">
                        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
                        <input type="email" id="admin-email" value="super@admin.com">
                    </div>
                    <div class="form-group">
                        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
                        <input type="password" id="admin-password" value="super123456">
                    </div>
                    <button class="btn" onclick="adminLogin()">Ø¯Ø®ÙˆÙ„</button>
                </div>

                <!-- Student Login -->
                <div class="card">
                    <h3>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
                    <div class="form-group">
                        <label>Ø§Ù„Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ:</label>
                        <input type="text" id="student-id" placeholder="CS2025001">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ:</label>
                        <input type="text" id="student-code" placeholder="ABC123">
                    </div>
                    <button class="btn" onclick="studentLogin()">Ø¯Ø®ÙˆÙ„</button>
                    <button class="btn secondary" onclick="registerFace()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙˆØ¬Ù‡</button>
                </div>
            </div>

            <div id="user-info" class="user-info" style="display: none;">
                <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ:</h3>
                <div id="user-details"></div>
            </div>

            <div class="response-box" id="auth-response"></div>
        </div>

        <!-- Students Panel -->
        <div id="students-panel" class="panel">
            <h2>ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
            
            <div class="grid">
                <!-- Add Single Student -->
                <div class="card">
                    <h3>Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ ÙˆØ§Ø­Ø¯</h3>
                    <div class="form-group">
                        <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</label>
                        <input type="text" id="student-name" placeholder="Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø´Ø¹Ø¨Ø©:</label>
                        <select id="student-section">
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©:</label>
                        <select id="student-year">
                            <option value="1">Ø§Ù„Ø£ÙˆÙ„Ù‰</option>
                            <option value="2">Ø§Ù„Ø«Ø§Ù†ÙŠØ©</option>
                            <option value="3">Ø§Ù„Ø«Ø§Ù„Ø«Ø©</option>
                            <option value="4">Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©:</label>
                        <select id="student-type">
                            <option value="morning">ØµØ¨Ø§Ø­ÙŠ</option>
                            <option value="evening">Ù…Ø³Ø§Ø¦ÙŠ</option>
                            <option value="hosted">Ø§Ø³ØªØ¶Ø§ÙØ©</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ù‚Ø³Ù…:</label>
                        <input type="text" id="student-department" value="CS">
                    </div>
                    <div class="form-group">
                        <label>Ø³Ù†Ø© ØªØ­Ù…ÙŠÙ„:</label>
                        <input type="checkbox" id="student-repeater">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø±Ø§Ø³Ø¨Ø© (Ù…ÙØµÙˆÙ„Ø© Ø¨ÙØ§ØµÙ„Ø©):</label>
                        <input type="text" id="student-failed" placeholder="Math101,CS201">
                    </div>
                    <button class="btn" onclick="addStudent()">Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</button>
                </div>

                <!-- Bulk Import -->
                <div class="card">
                    <h3>Ø¥Ø¶Ø§ÙØ© Ø¯ÙØ¹Ø© Ø·Ù„Ø§Ø¨</h3>
                    <div class="info-box">
                        <p>Ø±ÙØ¹ Ù…Ù„Ù Excel/CSV ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</p>
                        <p>Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: full_name, section, study_year, study_type</p>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„Ù:</label>
                        <input type="file" id="student-file" accept=".csv,.xlsx,.xls">
                    </div>
                    <button class="btn secondary" onclick="downloadTemplate()">ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ù„Ø¨</button>
                    <button class="btn" onclick="importStudents()">Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù</button>
                </div>
            </div>

            <!-- Students List -->
            <div class="card">
                <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
                <div class="grid">
                    <div class="form-group">
                        <label>ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø´Ø¹Ø¨Ø©:</label>
                        <select id="filter-section" onchange="loadStudents()">
                            <option value="">Ø§Ù„ÙƒÙ„</option>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø³Ù†Ø©:</label>
                        <select id="filter-year" onchange="loadStudents()">
                            <option value="">Ø§Ù„ÙƒÙ„</option>
                            <option value="1">Ø§Ù„Ø£ÙˆÙ„Ù‰</option>
                            <option value="2">Ø§Ù„Ø«Ø§Ù†ÙŠØ©</option>
                            <option value="3">Ø§Ù„Ø«Ø§Ù„Ø«Ø©</option>
                            <option value="4">Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©</option>
                        </select>
                    </div>
                </div>
                <button class="btn" onclick="loadStudents()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
                <button class="btn secondary" onclick="exportStudents()">ØªØµØ¯ÙŠØ± CSV</button>
                <div id="students-list"></div>
            </div>

            <div class="response-box" id="students-response"></div>
        </div>

        <!-- Rooms Panel -->
        <div id="rooms-panel" class="panel">
            <h2>ğŸ¢ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¹Ø§Øª Ø«Ù„Ø§Ø«ÙŠØ© Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯</h2>
            
            <div class="grid">
                <!-- Add Room -->
                <div class="card">
                    <h3>Ø¥Ø¶Ø§ÙØ© Ù‚Ø§Ø¹Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø¹Ø©:</label>
                        <input type="text" id="room-name" placeholder="A101">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ù…Ø¨Ù†Ù‰:</label>
                        <input type="text" id="room-building" placeholder="Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø·Ø§Ø¨Ù‚:</label>
                        <input type="number" id="room-floor" value="1">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ø±ØªÙØ§Ø¹ Ø£Ø±Ø¶ÙŠØ© Ø§Ù„Ù‚Ø§Ø¹Ø© (Ù…ØªØ±):</label>
                        <input type="number" id="room-floor-altitude" value="0" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø³Ù‚Ù (Ù…ØªØ±):</label>
                        <input type="number" id="room-ceiling-height" value="3.5" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Ø³Ø¹Ø© Ø§Ù„Ù‚Ø§Ø¹Ø©:</label>
                        <input type="number" id="room-capacity" value="30">
                    </div>
                    <button class="btn" onclick="showRoomMap()">Ø±Ø³Ù… Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù‚Ø§Ø¹Ø©</button>
                    <button class="btn success" onclick="addRoom()">Ø­ÙØ¸ Ø§Ù„Ù‚Ø§Ø¹Ø©</button>
                </div>

                <!-- Dynamic Room Recording -->
                <div class="card">
                    <h3>ØªØ³Ø¬ÙŠÙ„ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ Ù„Ù„Ù‚Ø§Ø¹Ø©</h3>
                    <div class="warning-box">
                        <p>Ø§Ù…Ø´Ù Ø­ÙˆÙ„ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù‚Ø§Ø¹Ø© Ù…Ø¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>
                        <p>ÙŠØªØ·Ù„Ø¨ GPS Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¯Ù‚Ø© + Ø¨Ø§Ø±ÙˆÙ…ØªØ±</p>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø¹Ø© Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØ³Ø¬ÙŠÙ„Ù‡Ø§:</label>
                        <input type="text" id="record-room-name" placeholder="A101">
                    </div>
                    <button class="btn" onclick="startRecording()">Ø¨Ø¯Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
                    <button class="btn danger" onclick="stopRecording()">Ø¥ÙŠÙ‚Ø§Ù ÙˆØ­ÙØ¸</button>
                    <div id="recording-status"></div>
                </div>
            </div>

            <!-- Rooms List -->
            <div class="card">
                <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ø§Ø¹Ø§Øª</h3>
                <button class="btn" onclick="loadRooms()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
                <div id="rooms-list"></div>
            </div>

            <div class="response-box" id="rooms-response"></div>
        </div>

        <!-- Schedules Panel -->
        <div id="schedules-panel" class="panel">
            <h2>ğŸ“… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</h2>
            
            <div class="grid">
                <!-- Add Schedule -->
                <div class="card">
                    <h3>Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙˆÙ„ Ø¬Ø¯ÙŠØ¯</h3>
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©:</label>
                        <input type="text" id="schedule-subject" placeholder="Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©">
                    </div>
                    <div class="form-group">
                        <label>Ø±Ù…Ø² Ø§Ù„Ù…Ø§Ø¯Ø©:</label>
                        <input type="text" id="schedule-code" placeholder="CS301">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ù…Ø¯Ø±Ø³:</label>
                        <select id="schedule-teacher"></select>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ù‚Ø§Ø¹Ø©:</label>
                        <select id="schedule-room"></select>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø´Ø¹Ø¨Ø©:</label>
                        <select id="schedule-section">
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©:</label>
                        <select id="schedule-year">
                            <option value="1">Ø§Ù„Ø£ÙˆÙ„Ù‰</option>
                            <option value="2">Ø§Ù„Ø«Ø§Ù†ÙŠØ©</option>
                            <option value="3">Ø§Ù„Ø«Ø§Ù„Ø«Ø©</option>
                            <option value="4">Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©:</label>
                        <select id="schedule-study-type">
                            <option value="morning">ØµØ¨Ø§Ø­ÙŠ</option>
                            <option value="evening">Ù…Ø³Ø§Ø¦ÙŠ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„ÙŠÙˆÙ…:</label>
                        <select id="schedule-day">
                            <option value="SUNDAY">Ø§Ù„Ø£Ø­Ø¯</option>
                            <option value="MONDAY">Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†</option>
                            <option value="TUESDAY">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option>
                            <option value="WEDNESDAY">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option>
                            <option value="THURSDAY">Ø§Ù„Ø®Ù…ÙŠØ³</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©:</label>
                        <input type="time" id="schedule-start">
                    </div>
                    <div class="form-group">
                        <label>ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ©:</label>
                        <input type="time" id="schedule-end">
                    </div>
                    <button class="btn" onclick="addSchedule()">Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙˆÙ„</button>
                </div>

                <!-- Current Schedule -->
                <div class="card">
                    <h3>Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>
                    <button class="btn" onclick="getCurrentSchedule()">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</button>
                    <div id="current-schedule"></div>
                </div>
            </div>

            <!-- Schedules List -->
            <div class="card">
                <h3>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„</h3>
                <button class="btn" onclick="loadSchedules()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
                <div id="schedules-list"></div>
            </div>

            <div class="response-box" id="schedules-response"></div>
        </div>

        <!-- Lectures Panel -->
        <div id="lectures-panel" class="panel">
            <h2>ğŸ“š Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</h2>
            
            <div class="grid">
                <div class="card">
                    <h3>Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­Ø§Ø¶Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                    <div class="form-group">
                        <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©:</label>
                        <input type="text" id="lecture-title" placeholder="Ø¨Ø±Ù…Ø¬Ø© Ù…ØªÙ‚Ø¯Ù…Ø© - Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© 1">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„ÙˆØµÙ:</label>
                        <textarea id="lecture-description" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ù‚Ø§Ø¹Ø©:</label>
                        <select id="lecture-room-select"></select>
                    </div>
                    <div class="form-group">
                        <label>ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©:</label>
                        <input type="datetime-local" id="lecture-start">
                    </div>
                    <div class="form-group">
                        <label>ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ©:</label>
                        <input type="datetime-local" id="lecture-end">
                    </div>
                    <button class="btn" onclick="createLecture()">Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­Ø§Ø¶Ø±Ø©</button>
                </div>

                <div class="card">
                    <h3>Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</h3>
                    <button class="btn secondary" onclick="getLectures()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
                    <div id="lectures-list"></div>
                </div>
            </div>

            <div class="response-box" id="lectures-response"></div>
        </div>

        <!-- QR Panel -->
        <div id="qr-panel" class="panel">
            <h2>ğŸ“± Ù†Ø¸Ø§Ù… QR Code</h2>
            
            <div class="card">
                <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª QR</h3>
                <div class="form-group">
                    <label>Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©:</label>
                    <input type="number" id="qr-lecture-id" placeholder="1">
                </div>
                <div class="form-group">
                    <label>Ù…Ø¯Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© (Ø«Ø§Ù†ÙŠØ©):</label>
                    <input type="number" id="qr-duration" value="60" min="30" max="300">
                </div>
                <button class="btn" onclick="generateQR()">ØªÙˆÙ„ÙŠØ¯ QR Code</button>
            </div>
            
            <div class="qr-container">
                <div id="qr-display"></div>
            </div>

            <div class="response-box" id="qr-response"></div>
        </div>

        <!-- Attendance Panel -->
        <div id="attendance-panel" class="panel">
            <h2>âœ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± - Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ</h2>
            
            <div class="grid">
                <!-- Location Verification -->
                <div class="card">
                    <h3>1ï¸âƒ£ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹</h3>
                    <div class="form-group">
                        <label>Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©:</label>
                        <input type="number" id="attendance-lecture-id" placeholder="1">
                    </div>
                    <div class="form-group">
                        <label>Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶ (Latitude):</label>
                        <input type="number" id="attendance-lat" placeholder="33.3152" step="0.0001">
                    </div>
                    <div class="form-group">
                        <label>Ø®Ø· Ø§Ù„Ø·ÙˆÙ„ (Longitude):</label>
                        <input type="number" id="attendance-lng" placeholder="44.3661" step="0.0001">
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ (Altitude):</label>
                        <input type="number" id="attendance-altitude" placeholder="280" step="0.1">
                    </div>
                    <button class="btn" onclick="verifyLocation()">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹</button>
                </div>

                <!-- QR & Face -->
                <div class="card">
                    <h3>2ï¸âƒ£ + 3ï¸âƒ£ QR + Ø¨ØµÙ…Ø© Ø§Ù„ÙˆØ¬Ù‡</h3>
                    <div class="form-group">
                        <label>Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ (Ù…Ù† Ø§Ù„Ø®Ø·ÙˆØ© 1):</label>
                        <input type="text" id="verification-token" readonly>
                    </div>
                    <div class="form-group">
                        <label>Ø±Ù…Ø² QR:</label>
                        <textarea id="attendance-qr" rows="3" placeholder="Ø§Ù„ØµÙ‚ Ø±Ù…Ø² QR Ù‡Ù†Ø§"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Ø¨ØµÙ…Ø© Ø§Ù„ÙˆØ¬Ù‡:</label>
                        <input type="checkbox" id="face-verified"> ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙˆØ¬Ù‡ Ø¨Ù†Ø¬Ø§Ø­
                    </div>
                    <button class="btn success" onclick="checkIn()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</button>
                    <button class="btn warning" onclick="exceptionalCheckIn()">Ø­Ø¶ÙˆØ± Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠ</button>
                </div>

                <!-- My Attendance -->
                <div class="card">
                    <h3>Ø³Ø¬Ù„ Ø­Ø¶ÙˆØ±ÙŠ</h3>
                    <button class="btn secondary" onclick="getMyAttendance()">Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„</button>
                    <div id="my-attendance"></div>
                </div>
            </div>

            <div class="response-box" id="attendance-response"></div>
        </div>

        <!-- Reports Panel -->
        <div id="reports-panel" class="panel">
            <h2>ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h2>
            
            <div class="grid">
                <div class="card">
                    <h3>ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
                    <div class="form-group">
                        <label>Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±:</label>
                        <select id="report-type">
                            <option value="daily">ÙŠÙˆÙ…ÙŠ</option>
                            <option value="weekly">Ø£Ø³Ø¨ÙˆØ¹ÙŠ</option>
                            <option value="monthly">Ø´Ù‡Ø±ÙŠ</option>
                            <option value="semester">ÙØµÙ„ÙŠ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø´Ø¹Ø¨Ø©:</label>
                        <select id="report-section">
                            <option value="">Ø§Ù„ÙƒÙ„</option>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                        </select>
                    </div>
                    <button class="btn" onclick="generateReport()">ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ±</button>
                    <button class="btn secondary" onclick="downloadReport()">ØªØ­Ù…ÙŠÙ„ PDF</button>
                </div>

                <div class="card">
                    <h3>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø©</h3>
                    <button class="btn" onclick="getStatistics()">Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
                    <div id="statistics"></div>
                </div>
            </div>

            <div class="response-box" id="reports-response"></div>
        </div>

        <a href="/api/docs" class="swagger-link" target="_blank">
            ğŸ“– Swagger API Documentation
        </a>
    </div>

    <!-- Room Map Modal -->
    <div id="roomMapModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeRoomMap()">&times;</span>
            <h2>Ø±Ø³Ù… Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù‚Ø§Ø¹Ø©</h2>
            <div class="info-box">
                <p>Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø§Ø· Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù‚Ø§Ø¹Ø©</p>
                <p>ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© 3 Ù†Ù‚Ø§Ø· Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„</p>
            </div>
            <div id="room-map" class="room-map"></div>
            <div id="room-points"></div>
            <button class="btn success" onclick="saveRoomBoundaries()">Ø­ÙØ¸ Ø§Ù„Ø­Ø¯ÙˆØ¯</button>
        </div>
    </div>

    <script>
        const API_BASE = 'http://127.0.0.1:5000/api';
        let authToken = localStorage.getItem('authToken');
        let currentUser = null;
        let roomPoints = [];
        let recordingPoints = [];
        let isRecording = false;

        // Initialize
        window.onload = function() {
            if (authToken) {
                getCurrentUser();
            }
            loadInitialData();
        };

        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            document.getElementById(`${tabName}-panel`).classList.add('active');
            event.target.classList.add('active');
        }

        // API Helper
        async function apiCall(endpoint, method = 'GET', data = null, isFormData = false) {
            const options = {
                method,
                headers: {}
            };

            if (!isFormData) {
                options.headers['Content-Type'] = 'application/json';
            }

            if (authToken) {
                options.headers['Authorization'] = `Bearer ${authToken}`;
            }

            if (data) {
                if (isFormData) {
                    options.body = data;
                } else {
                    options.body = JSON.stringify(data);
                }
            }

            try {
                const response = await fetch(`${API_BASE}${endpoint}`, options);
                const result = await response.json();
                return { status: response.status, data: result };
            } catch (error) {
                return { status: 500, data: { error: true, message: error.message } };
            }
        }

        // Display Response
        function displayResponse(elementId, response) {
            const element = document.getElementById(elementId);
            const statusBadge = response.status >= 200 && response.status < 300 ? 
                '<span class="status-badge success">Ù†Ø¬Ø­</span>' : 
                '<span class="status-badge error">ÙØ´Ù„</span>';

            element.innerHTML = `
                ${statusBadge}
                <strong>Status:</strong> ${response.status}
                <strong>Response:</strong>
                ${JSON.stringify(response.data, null, 2)}
            `;
        }

        // 1. AUTH FUNCTIONS
        async function adminLogin() {
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;

            const response = await apiCall('/auth/login', 'POST', { email, password });

            if (response.status === 200) {
                authToken = response.data.data.access_token;
                localStorage.setItem('authToken', authToken);
                currentUser = response.data.data.user;
                showUserInfo();
                loadInitialData();
            }

            displayResponse('auth-response', response);
        }

        async function studentLogin() {
            const university_id = document.getElementById('student-id').value;
            const secret_code = document.getElementById('student-code').value;

            const response = await apiCall('/auth/student-login', 'POST', { 
                university_id, 
                secret_code 
            });

            if (response.status === 200) {
                authToken = response.data.data.access_token;
                localStorage.setItem('authToken', authToken);
                currentUser = response.data.data.user;
                showUserInfo();
            }

            displayResponse('auth-response', response);
        }

        async function registerFace() {
            const response = await apiCall('/auth/register-face', 'POST', {});
            displayResponse('auth-response', response);
        }

        async function getCurrentUser() {
            const response = await apiCall('/auth/me', 'GET');
            if (response.status === 200) {
                currentUser = response.data.data;
                showUserInfo();
            }
        }

        function showUserInfo() {
            const userInfo = document.getElementById('user-info');
            const userDetails = document.getElementById('user-details');
            userInfo.style.display = 'block';
            userDetails.innerHTML = `
                <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${currentUser.name}</p>
                <p><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯:</strong> ${currentUser.email}</p>
                <p><strong>Ø§Ù„Ø¯ÙˆØ±:</strong> ${currentUser.role}</p>
                ${currentUser.student_profile ? `
                    <p><strong>Ø§Ù„Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ:</strong> ${currentUser.student_profile.university_id}</p>
                    <p><strong>Ø§Ù„Ø´Ø¹Ø¨Ø©:</strong> ${currentUser.student_profile.section}</p>
                    <p><strong>Ø§Ù„Ø³Ù†Ø©:</strong> ${currentUser.student_profile.study_year}</p>
                ` : ''}
            `;
        }

        // 2. STUDENTS FUNCTIONS
        async function addStudent() {
            const data = {
                full_name: document.getElementById('student-name').value,
                section: document.getElementById('student-section').value,
                study_year: parseInt(document.getElementById('student-year').value),
                study_type: document.getElementById('student-type').value,
                department: document.getElementById('student-department').value,
                is_repeater: document.getElementById('student-repeater').checked,
                failed_subjects: document.getElementById('student-failed').value.split(',').filter(s => s)
            };

            const response = await apiCall('/admin/students', 'POST', data);
            displayResponse('students-response', response);

            if (response.status === 201) {
                const creds = response.data.data.credentials;
                alert(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!\nØ§Ù„Ù…Ø¹Ø±Ù: ${creds.university_id}\nØ§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ: ${creds.secret_code}`);
                loadStudents();
            }
        }

        async function importStudents() {
            const fileInput = document.getElementById('student-file');
            if (!fileInput.files[0]) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù');
                return;
            }

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            const response = await apiCall('/admin/students/bulk', 'POST', formData, true);
            displayResponse('students-response', response);
        }

        async function downloadTemplate() {
            window.open(`${API_BASE}/admin/students/template`, '_blank');
        }

        async function loadStudents() {
            const section = document.getElementById('filter-section').value;
            const year = document.getElementById('filter-year').value;
            
            let url = '/admin/students?';
            if (section) url += `section=${section}&`;
            if (year) url += `study_year=${year}&`;

            const response = await apiCall(url, 'GET');
            
            if (response.status === 200) {
                const students = response.data.data.students;
                const listDiv = document.getElementById('students-list');
                
                if (students.length === 0) {
                    listDiv.innerHTML = '<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨</p>';
                    return;
                }

                let html = '<table class="table"><thead><tr>';
                html += '<th>Ø§Ù„Ù…Ø¹Ø±Ù</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø´Ø¹Ø¨Ø©</th><th>Ø§Ù„Ø³Ù†Ø©</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>';
                html += '</tr></thead><tbody>';

                students.forEach(student => {
                    html += `<tr>
                        <td>${student.university_id}</td>
                        <td>${student.full_name}</td>
                        <td>${student.section}</td>
                        <td>${student.study_year}</td>
                        <td>${student.study_type}</td>
                        <td>
                            <button class="btn secondary" onclick="resetStudentCode(${student.id})">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø±Ù…Ø²</button>
                        </td>
                    </tr>`;
                });

                html += '</tbody></table>';
                listDiv.innerHTML = html;
            }

            displayResponse('students-response', response);
        }

        async function resetStudentCode(studentId) {
            const response = await apiCall(`/admin/students/${studentId}/reset-code`, 'POST');
            if (response.status === 200) {
                const data = response.data.data;
                alert(`ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø±Ù…Ø²!\nØ§Ù„Ù…Ø¹Ø±Ù: ${data.university_id}\nØ§Ù„Ø±Ù…Ø² Ø§Ù„Ø¬Ø¯ÙŠØ¯: ${data.new_code}`);
            }
            displayResponse('students-response', response);
        }

        async function exportStudents() {
            const section = document.getElementById('filter-section').value;
            const year = document.getElementById('filter-year').value;
            
            let url = `${API_BASE}/admin/students/export?`;
            if (section) url += `section=${section}&`;
            if (year) url += `study_year=${year}`;

            window.open(url, '_blank');
        }

        // 3. ROOMS FUNCTIONS
        async function addRoom() {
            if (roomPoints.length < 3) {
                alert('ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ¯ 3 Ù†Ù‚Ø§Ø· Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù‚Ø§Ø¹Ø©');
                return;
            }

            const data = {
                name: document.getElementById('room-name').value,
                building: document.getElementById('room-building').value,
                floor: parseInt(document.getElementById('room-floor').value),
                floor_altitude: parseFloat(document.getElementById('room-floor-altitude').value),
                ceiling_height: parseFloat(document.getElementById('room-ceiling-height').value),
                capacity: parseInt(document.getElementById('room-capacity').value),
                gps_boundaries: roomPoints,
                center_latitude: roomPoints.reduce((sum, p) => sum + p.lat, 0) / roomPoints.length,
                center_longitude: roomPoints.reduce((sum, p) => sum + p.lng, 0) / roomPoints.length
            };

            const response = await apiCall('/admin/rooms', 'POST', data);
            displayResponse('rooms-response', response);

            if (response.status === 201) {
                loadRooms();
                roomPoints = [];
                closeRoomMap();
            }
        }

        async function loadRooms() {
            const response = await apiCall('/admin/rooms', 'GET');
            
            if (response.status === 200) {
                const rooms = response.data.data;
                const listDiv = document.getElementById('rooms-list');
                const roomSelect = document.getElementById('schedule-room');
                const lectureRoomSelect = document.getElementById('lecture-room-select');
                
                // Update room selects
                roomSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø§Ø¹Ø©</option>';
                if (lectureRoomSelect) {
                    lectureRoomSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø§Ø¹Ø©</option>';
                }
                
                if (rooms.length === 0) {
                    listDiv.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø§Ø¹Ø§Øª</p>';
                    return;
                }

                let html = '<table class="table"><thead><tr>';
                html += '<th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù…Ø¨Ù†Ù‰</th><th>Ø§Ù„Ø·Ø§Ø¨Ù‚</th><th>Ø§Ù„Ø§Ø±ØªÙØ§Ø¹</th><th>Ø§Ù„Ø³Ø¹Ø©</th><th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>';
                html += '</tr></thead><tbody>';

                rooms.forEach(room => {
                    // Add to selects
                    roomSelect.innerHTML += `<option value="${room.id}">${room.name}</option>`;
                    if (lectureRoomSelect) {
                        lectureRoomSelect.innerHTML += `<option value="${room.id}">${room.name}</option>`;
                    }

                    html += `<tr>
                        <td>${room.name}</td>
                        <td>${room.building}</td>
                        <td>${room.floor}</td>
                        <td>${room.floor_altitude}Ù… - ${room.floor_altitude + room.ceiling_height}Ù…</td>
                        <td>${room.capacity}</td>
                        <td>
                            <button class="btn secondary" onclick="checkRoomLocation(${room.id})">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹</button>
                        </td>
                    </tr>`;
                });

                html += '</tbody></table>';
                listDiv.innerHTML = html;
            }

            displayResponse('rooms-response', response);
        }

        async function checkRoomLocation(roomId) {
            const lat = prompt('Ø£Ø¯Ø®Ù„ Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶:');
            const lng = prompt('Ø£Ø¯Ø®Ù„ Ø®Ø· Ø§Ù„Ø·ÙˆÙ„:');
            const alt = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹:');

            if (!lat || !lng) return;

            const data = {
                latitude: parseFloat(lat),
                longitude: parseFloat(lng),
                altitude: alt ? parseFloat(alt) : null
            };

            const response = await apiCall(`/admin/rooms/${roomId}/check-location`, 'POST', data);
            
            if (response.status === 200) {
                const result = response.data.data;
                let msg = `Ø§Ù„Ù…ÙˆÙ‚Ø¹ ${result.is_inside ? 'Ø¯Ø§Ø®Ù„' : 'Ø®Ø§Ø±Ø¬'} Ø§Ù„Ù‚Ø§Ø¹Ø©\n`;
                msg += `Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† Ø§Ù„Ù…Ø±ÙƒØ²: ${result.distance_from_center} Ù…ØªØ±\n`;
                if (result.altitude_valid !== null) {
                    msg += `Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ ${result.altitude_valid ? 'ØµØ­ÙŠØ­' : 'Ø®Ø§Ø·Ø¦'}`;
                }
                alert(msg);
            }

            displayResponse('rooms-response', response);
        }

        function showRoomMap() {
            document.getElementById('roomMapModal').style.display = 'block';
            roomPoints = [];
            updateRoomPoints();
        }

        function closeRoomMap() {
            document.getElementById('roomMapModal').style.display = 'none';
        }

        function updateRoomPoints() {
            const pointsDiv = document.getElementById('room-points');
            if (roomPoints.length === 0) {
                pointsDiv.innerHTML = '<p>Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø§Ø· Ø¨Ø¹Ø¯</p>';
                return;
            }

            let html = '<h4>Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©:</h4><ul>';
            roomPoints.forEach((point, index) => {
                html += `<li>Ù†Ù‚Ø·Ø© ${index + 1}: ${point.lat.toFixed(6)}, ${point.lng.toFixed(6)}</li>`;
            });
            html += '</ul>';
            pointsDiv.innerHTML = html;
        }

        // Simulate map click (in real app, use Google Maps or Leaflet)
        document.getElementById('room-map').addEventListener('click', function(e) {
            const rect = this.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Convert to lat/lng (simplified)
            const lat = 33.3152 + (y / rect.height) * 0.001;
            const lng = 44.3661 + (x / rect.width) * 0.001;
            
            roomPoints.push({ lat, lng });
            
            // Draw point
            const point = document.createElement('div');
            point.style.position = 'absolute';
            point.style.left = x - 5 + 'px';
            point.style.top = y - 5 + 'px';
            point.style.width = '10px';
            point.style.height = '10px';
            point.style.borderRadius = '50%';
            point.style.backgroundColor = '#667eea';
            this.appendChild(point);
            
            updateRoomPoints();
        });

        function saveRoomBoundaries() {
            if (roomPoints.length < 3) {
                alert('ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ¯ 3 Ù†Ù‚Ø§Ø· Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }
            closeRoomMap();
        }

        // Dynamic Recording
        async function startRecording() {
            const roomName = document.getElementById('record-room-name').value;
            if (!roomName) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ø§Ø¹Ø©');
                return;
            }

            isRecording = true;
            recordingPoints = [];
            document.getElementById('recording-status').innerHTML = 
                '<div class="success-box">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„... Ø§Ù…Ø´Ù Ø­ÙˆÙ„ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù‚Ø§Ø¹Ø©</div>';

            // Simulate GPS recording (in real app, use actual GPS)
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(
                    position => {
                        if (isRecording) {
                            recordingPoints.push({
                                latitude: position.coords.latitude,
                                longitude: position.coords.longitude,
                                altitude: position.coords.altitude,
                                accuracy: position.coords.accuracy
                            });
                            
                            document.getElementById('recording-status').innerHTML = 
                                `<div class="success-box">ØªÙ… ØªØ³Ø¬ÙŠÙ„ ${recordingPoints.length} Ù†Ù‚Ø·Ø©</div>`;
                        }
                    },
                    error => {
                        alert('Ø®Ø·Ø£ ÙÙŠ GPS: ' + error.message);
                    },
                    { enableHighAccuracy: true }
                );
            }
        }

        async function stopRecording() {
            if (!isRecording || recordingPoints.length < 3) {
                alert('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ 3 Ù†Ù‚Ø§Ø· Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }

            isRecording = false;
            
            const data = {
                room_name: document.getElementById('record-room-name').value,
                path_points: recordingPoints,
                building: 'Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ',
                floor: 1,
                ceiling_height: 3.5
            };

            const response = await apiCall('/admin/rooms/record-path', 'POST', data);
            displayResponse('rooms-response', response);

            if (response.status === 200) {
                document.getElementById('recording-status').innerHTML = 
                    '<div class="success-box">ØªÙ… Ø­ÙØ¸ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù‚Ø§Ø¹Ø© Ø¨Ù†Ø¬Ø§Ø­</div>';
                loadRooms();
            }
        }

        // 4. SCHEDULES FUNCTIONS
        async function addSchedule() {
            const data = {
                subject_name: document.getElementById('schedule-subject').value,
                subject_code: document.getElementById('schedule-code').value,
                teacher_id: parseInt(document.getElementById('schedule-teacher').value),
                room_id: parseInt(document.getElementById('schedule-room').value),
                section: document.getElementById('schedule-section').value,
                study_year: parseInt(document.getElementById('schedule-year').value),
                study_type: document.getElementById('schedule-study-type').value,
                day_of_week: document.getElementById('schedule-day').value,
                start_time: document.getElementById('schedule-start').value,
                end_time: document.getElementById('schedule-end').value
            };

            const response = await apiCall('/schedules', 'POST', data);
            displayResponse('schedules-response', response);

            if (response.status === 201) {
                loadSchedules();
            }
        }

        async function loadSchedules() {
            const response = await apiCall('/schedules', 'GET');
            
            if (response.status === 200) {
                const schedules = response.data.data;
                const listDiv = document.getElementById('schedules-list');
                
                if (schedules.length === 0) {
                    listDiv.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ø¯Ø§ÙˆÙ„</p>';
                    return;
                }

                // Group by day
                const byDay = {};
                schedules.forEach(schedule => {
                    if (!byDay[schedule.day]) byDay[schedule.day] = [];
                    byDay[schedule.day].push(schedule);
                });

                let html = '';
                Object.keys(byDay).forEach(day => {
                    html += `<h4>${day}</h4>`;
                    html += '<table class="table"><thead><tr>';
                    html += '<th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ø§Ù„Ù…Ø¯Ø±Ø³</th><th>Ø§Ù„Ù‚Ø§Ø¹Ø©</th><th>Ø§Ù„Ø´Ø¹Ø¨Ø©</th><th>Ø§Ù„ÙˆÙ‚Øª</th>';
                    html += '</tr></thead><tbody>';

                    byDay[day].forEach(schedule => {
                        html += `<tr>
                            <td>${schedule.subject_name}</td>
                            <td>${schedule.teacher}</td>
                            <td>${schedule.room}</td>
                            <td>${schedule.section}-${schedule.study_year}</td>
                            <td>${schedule.start_time} - ${schedule.end_time}</td>
                        </tr>`;
                    });

                    html += '</tbody></table>';
                });

                listDiv.innerHTML = html;
            }

            displayResponse('schedules-response', response);
        }

        async function getCurrentSchedule() {
            const response = await apiCall('/schedules/current', 'GET');
            
            if (response.status === 200) {
                const data = response.data.data;
                const div = document.getElementById('current-schedule');
                
                if (data.current) {
                    const schedule = data.current;
                    div.innerHTML = `
                        <div class="success-box">
                            <h4>Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h4>
                            <p><strong>Ø§Ù„Ù…Ø§Ø¯Ø©:</strong> ${schedule.subject_name}</p>
                            <p><strong>Ø§Ù„Ù…Ø¯Ø±Ø³:</strong> ${schedule.teacher}</p>
                            <p><strong>Ø§Ù„Ù‚Ø§Ø¹Ø©:</strong> ${schedule.room}</p>
                            <p><strong>Ø§Ù„ÙˆÙ‚Øª:</strong> ${schedule.start_time} - ${schedule.end_time}</p>
                        </div>
                    `;
                } else {
                    div.innerHTML = '<div class="info-box">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</div>';
                }
            }

            displayResponse('schedules-response', response);
        }

        // 5. LECTURES FUNCTIONS
        async function createLecture() {
            const roomSelect = document.getElementById('lecture-room-select');
            const roomId = parseInt(roomSelect.value);
            
            if (!roomId) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø§Ø¹Ø©');
                return;
            }

            // Get room details for location
            const roomResponse = await apiCall(`/admin/rooms/${roomId}`, 'GET');
            if (roomResponse.status !== 200) {
                alert('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ø¹Ø©');
                return;
            }

            const room = roomResponse.data.data;

            const data = {
                title: document.getElementById('lecture-title').value,
                description: document.getElementById('lecture-description').value,
                room: room.name,
                start_time: document.getElementById('lecture-start').value,
                end_time: document.getElementById('lecture-end').value,
                latitude: room.center.latitude,
                longitude: room.center.longitude
            };

            const response = await apiCall('/lectures', 'POST', data);
            displayResponse('lectures-response', response);

            if (response.status === 201) {
                getLectures();
            }
        }

        async function getLectures() {
            const response = await apiCall('/lectures', 'GET');
            displayResponse('lectures-response', response);

            if (response.status === 200 && response.data.data) {
                const lectures = response.data.data;
                const listDiv = document.getElementById('lectures-list');
                
                if (lectures.length === 0) {
                    listDiv.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª</p>';
                    return;
                }

                let html = '<div class="grid">';
                lectures.forEach(lecture => {
                    const startTime = new Date(lecture.start_time);
                    const endTime = new Date(lecture.end_time);
                    const now = new Date();
                    const isActive = now >= startTime && now <= endTime;

                    html += `
                        <div class="card">
                            <h3>${lecture.title}</h3>
                            <p><strong>Ø§Ù„Ù‚Ø§Ø¹Ø©:</strong> ${lecture.room}</p>
                            <p><strong>Ø§Ù„Ù…Ø¯Ø±Ø³:</strong> ${lecture.teacher ? lecture.teacher.name : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                            <p><strong>Ø§Ù„ÙˆÙ‚Øª:</strong> ${startTime.toLocaleString('ar')}</p>
                            <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${isActive ? 
                                '<span class="status-badge success">Ù†Ø´Ø·Ø©</span>' : 
                                '<span class="status-badge">ØºÙŠØ± Ù†Ø´Ø·Ø©</span>'}</p>
                            ${isActive ? `<button class="btn" onclick="generateQRForLecture(${lecture.id})">ØªÙˆÙ„ÙŠØ¯ QR</button>` : ''}
                        </div>
                    `;
                });
                html += '</div>';
                
                listDiv.innerHTML = html;
            }
        }

        // 6. QR FUNCTIONS
        async function generateQR() {
            const lectureId = document.getElementById('qr-lecture-id').value;
            const duration = document.getElementById('qr-duration').value;

            const response = await apiCall(`/qr/generate/${lectureId}`, 'POST', {
                expires_in_seconds: parseInt(duration)
            });
            
            displayResponse('qr-response', response);

            if (response.status === 200) {
                const qrDisplay = document.getElementById('qr-display');
                const data = response.data.data;
                qrDisplay.innerHTML = `
                    <div class="qr-code">
                        <img src="${data.qr_image}" alt="QR Code" style="max-width: 300px;">
                        <p><strong>ØµØ§Ù„Ø­ Ù„Ù…Ø¯Ø©:</strong> ${data.expires_in} Ø«Ø§Ù†ÙŠØ©</p>
                        <p><strong>Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ù„Ø³Ø©:</strong> ${data.session_id}</p>
                        <p><strong>Ø§Ù„Ù‚Ø§Ø¹Ø©:</strong> ${data.lecture.room}</p>
                        <div class="warning-box" style="margin-top: 10px;">
                            <p><strong>Ø¨ÙŠØ§Ù†Ø§Øª QR Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±:</strong></p>
                            <textarea rows="5" style="width: 100%;" readonly>${JSON.stringify({
                                session_id: data.session_id,
                                lecture_id: data.lecture.id,
                                room_id: data.room_id || 1,
                                expires_at: data.expires_at,
                                expires_in: data.expires_in,
                                hash: 'test-hash'
                            }, null, 2)}</textarea>
                        </div>
                    </div>
                `;
            }
        }

        function generateQRForLecture(lectureId) {
            document.getElementById('qr-lecture-id').value = lectureId;
            showTab('qr');
            generateQR();
        }

        // 7. ATTENDANCE FUNCTIONS
        async function verifyLocation() {
            const data = {
                lecture_id: parseInt(document.getElementById('attendance-lecture-id').value),
                latitude: parseFloat(document.getElementById('attendance-lat').value),
                longitude: parseFloat(document.getElementById('attendance-lng').value),
                altitude: parseFloat(document.getElementById('attendance-altitude').value)
            };

            const response = await apiCall('/attendance/verify-location', 'POST', data);
            displayResponse('attendance-response', response);

            if (response.status === 200) {
                const token = response.data.data.verification_token;
                document.getElementById('verification-token').value = token;
                
                const successBox = document.createElement('div');
                successBox.className = 'success-box';
                successBox.innerHTML = `
                    <p>âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­!</p>
                    <p>Ø§Ù„Ù‚Ø§Ø¹Ø©: ${response.data.data.room}</p>
                    <p>ØµØ§Ù„Ø­ Ù„Ù…Ø¯Ø©: ${response.data.data.expires_in} Ø«Ø§Ù†ÙŠØ©</p>
                `;
                document.getElementById('attendance-response').prepend(successBox);
            }
        }

        async function checkIn() {
            const data = {
                qr_data: document.getElementById('attendance-qr').value,
                verification_token: document.getElementById('verification-token').value,
                face_verified: document.getElementById('face-verified').checked,
                latitude: parseFloat(document.getElementById('attendance-lat').value),
                longitude: parseFloat(document.getElementById('attendance-lng').value),
                altitude: parseFloat(document.getElementById('attendance-altitude').value)
            };

            const response = await apiCall('/attendance/checkin', 'POST', data);
            displayResponse('attendance-response', response);

            if (response.status === 200) {
                alert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±Ùƒ Ø¨Ù†Ø¬Ø§Ø­!');
                getMyAttendance();
            }
        }

        async function exceptionalCheckIn() {
            const data = {
                qr_data: document.getElementById('attendance-qr').value,
                face_verified: document.getElementById('face-verified').checked,
                exception_reason: 'GPS verification failed',
                latitude: parseFloat(document.getElementById('attendance-lat').value),
                longitude: parseFloat(document.getElementById('attendance-lng').value),
                altitude: parseFloat(document.getElementById('attendance-altitude').value)
            };

            const response = await apiCall('/attendance/exceptional-checkin', 'POST', data);
            displayResponse('attendance-response', response);
        }

        async function getMyAttendance() {
            const response = await apiCall('/attendance/my-records', 'GET');
            displayResponse('attendance-response', response);

            if (response.status === 200) {
                const data = response.data.data;
                const div = document.getElementById('my-attendance');
                
                let html = `
                    <div class="info-box">
                        <h4>Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h4>
                        <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª: ${data.statistics.total_lectures}</p>
                        <p>Ø§Ù„Ø­Ø¶ÙˆØ±: ${data.statistics.present}</p>
                        <p>Ø§Ù„ØºÙŠØ§Ø¨: ${data.statistics.absent}</p>
                        <p>Ù…Ø¹Ù„Ù‚: ${data.statistics.pending}</p>
                        <p>Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±: ${data.statistics.attendance_rate}%</p>
                    </div>
                `;

                if (data.records.length > 0) {
                    html += '<table class="table"><thead><tr>';
                    html += '<th>Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</th><th>Ø§Ù„Ù‚Ø§Ø¹Ø©</th><th>Ø§Ù„ÙˆÙ‚Øª</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th>';
                    html += '</tr></thead><tbody>';

                    data.records.forEach(record => {
                        const checkInTime = new Date(record.check_in_time);
                        html += `<tr>
                            <td>${record.lecture}</td>
                            <td>${record.room}</td>
                            <td>${checkInTime.toLocaleString('ar')}</td>
                            <td>
                                ${record.is_present ? 
                                    '<span class="status-badge success">Ø­Ø§Ø¶Ø±</span>' : 
                                    record.is_exceptional ? 
                                        '<span class="status-badge warning">Ù…Ø¹Ù„Ù‚</span>' :
                                        '<span class="status-badge error">ØºØ§Ø¦Ø¨</span>'
                                }
                            </td>
                        </tr>`;
                    });

                    html += '</tbody></table>';
                }

                div.innerHTML = html;
            }
        }

        // 8. REPORTS FUNCTIONS
        async function generateReport() {
            alert('ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± - Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±');
        }

        async function downloadReport() {
            alert('ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙƒÙ€ PDF - Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±');
        }

        async function getStatistics() {
            const div = document.getElementById('statistics');
            div.innerHTML = `
                <div class="info-box">
                    <h4>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h4>
                    <p>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†: 120</p>
                    <p>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…: 15</p>
                    <p>Ù…ØªÙˆØ³Ø· Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¶ÙˆØ±: 85%</p>
                    <p>Ø§Ù„Ù‚Ø§Ø¹Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©: 8</p>
                </div>
            `;
        }

        // Load initial data
        async function loadInitialData() {
            if (currentUser && (currentUser.role === 'admin' || currentUser.role === 'super_admin')) {
                loadTeachers();
                loadRooms();
            }
        }

        async function loadTeachers() {
            // This would normally be a separate API endpoint
            const teachers = [
                { id: 1, name: 'Ø¯. Ø£Ø­Ù…Ø¯ Ø­Ø³Ù†' },
                { id: 2, name: 'Ø¯. ÙØ§Ø·Ù…Ø© Ø¹Ù„ÙŠ' },
                { id: 3, name: 'Ø¯. Ù…Ø­Ù…Ø¯ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…' }
            ];

            const select = document.getElementById('schedule-teacher');
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯Ø±Ø³</option>';
            teachers.forEach(teacher => {
                select.innerHTML += `<option value="${teacher.id}">${teacher.name}</option>`;
            });
        }

        // Set default values for testing
        document.getElementById('admin-email').value = 'super@admin.com';
        document.getElementById('admin-password').value = 'super123456';
        document.getElementById('attendance-lat').value = '33.3152';
        document.getElementById('attendance-lng').value = '44.3661';
        document.getElementById('attendance-altitude').value = '280';
    </script>
</body>
</html>